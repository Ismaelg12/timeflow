<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - TimeFlow</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3f37c9;
            --success-color: #28a745;
            --info-color: #17a2b8;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
            --light-bg: #f5f7fb;
            --card-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --hover-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        }
        
        body {
            background-color: var(--light-bg);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #2d3748;
        }
        
        .container {
            max-width: 95%;
        }
        
        .card {
            border: none;
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
            overflow: hidden;
        }
        
        .card:hover {
            box-shadow: var(--hover-shadow);
        }
        
        .stat-card {
            border-radius: 12px;
            transition: transform 0.3s ease;
            border: none;
            overflow: hidden;
            min-height: 130px;
            cursor: pointer;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-icon {
            font-size: 2.5rem;
            opacity: 0.8;
        }
        
        .progress {
            height: 8px;
            border-radius: 4px;
        }
        
        .badge-status {
            padding: 0.5em 1em;
            border-radius: 20px;
            font-weight: 500;
        }
        
        .alert-card {
            border-left: 4px solid;
            margin-bottom: 0.5rem;
            transition: all 0.2s ease;
        }
        
        .alert-card:hover {
            transform: translateX(5px);
        }
        
        .alert-card.warning {
            border-left-color: var(--warning-color);
            background-color: rgba(255, 193, 7, 0.05);
        }
        
        .alert-card.danger {
            border-left-color: var(--danger-color);
            background-color: rgba(220, 53, 69, 0.05);
        }
        
        .alert-card.info {
            border-left-color: var(--info-color);
            background-color: rgba(23, 162, 184, 0.05);
        }
        
        .alert-card.success {
            border-left-color: var(--success-color);
            background-color: rgba(40, 167, 69, 0.05);
        }
        
        .chart-container {
            position: relative;
            height: 250px;
            width: 100%;
        }
        
        /* Custom colors for cards */
        .bg-primary-gradient {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)) !important;
        }
        
        .bg-success-gradient {
            background: linear-gradient(135deg, var(--success-color), #20c997) !important;
        }
        
        .bg-info-gradient {
            background: linear-gradient(135deg, var(--info-color), #0dcaf0) !important;
        }
        
        .bg-warning-gradient {
            background: linear-gradient(135deg, var(--warning-color), #fd7e14) !important;
        }
        
        .bg-danger-gradient {
            background: linear-gradient(135deg, var(--danger-color), #bb2d3b) !important;
        }
        
        /* Tabs personalizadas */
        .nav-tabs-custom .nav-link {
            border: none;
            border-bottom: 3px solid transparent;
            color: #6c757d;
            font-weight: 500;
            padding: 0.75rem 1.5rem;
            transition: all 0.3s ease;
        }
        
        .nav-tabs-custom .nav-link:hover {
            color: var(--primary-color);
            border-bottom-color: rgba(67, 97, 238, 0.3);
        }
        
        .nav-tabs-custom .nav-link.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
            background-color: transparent;
        }
        
        /* Lista compacta */
        .compact-list .list-group-item {
            padding: 0.75rem 1rem;
            border-left: none;
            border-right: none;
        }
        
        .compact-list .list-group-item:first-child {
            border-top: none;
        }
        
        .compact-list .list-group-item:last-child {
            border-bottom: none;
        }
        
        /* Status indicators */
        .status-indicator {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .status-success { background-color: var(--success-color); }
        .status-warning { background-color: var(--warning-color); }
        .status-danger { background-color: var(--danger-color); }
        .status-info { background-color: var(--info-color); }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .stat-card {
                margin-bottom: 1rem;
            }
            
            .stat-icon {
                font-size: 2rem;
            }
            
            .chart-container {
                height: 200px;
            }
            
            .nav-tabs-custom .nav-link {
                padding: 0.5rem 1rem;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary-gradient">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="{% url 'core:dashboard' %}">
                <i class="fas fa-chart-line me-2"></i> PontoFácil - Admin
            </a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link text-white d-flex align-items-center" href="/sair/">
                    <i class="fas fa-sign-out-alt me-1"></i> Sair
                </a>
            </div>
        </div>
    </nav>

    <div class="container py-4">
        <!-- Cabeçalho -->
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4">
            <div>
                <h1 class="page-title mb-1">
                    <i class="fas fa-tachometer-alt me-2" style="color: var(--primary-color);"></i>
                    Painel Administrativo
                </h1>
                <p class="text-muted mb-0">Bem-vindo, {{ request.user.username }}!</p>
                <small class="text-muted">
                    <i class="fas fa-calendar-alt me-1"></i>
                    {{ hoje|date:"d/m/Y" }} 
                    <i class="fas fa-clock ms-3 me-1"></i>
                    {{ agora|time:"H:i" }}
                </small>
            </div>
            <div class="mt-2 mt-md-0">
                <div class="btn-group">
                    <a href="{% url 'core:relatorios_gerais' %}" class="btn btn-outline-primary">
                        <i class="fas fa-chart-bar me-1"></i> Relatórios
                    </a>
                    <a href="{% url 'usuarios:listar_profissionais' %}" class="btn btn-outline-success">
                        <i class="fas fa-users me-1"></i> Profissionais
                    </a>
                </div>
            </div>
        </div>

        <!-- Filtros -->
        <div class="card mb-4">
            <div class="card-body py-3">
                <form method="get" class="row g-3 align-items-center">
                    <div class="col-md-3">
                        <label class="form-label mb-0">Período</label>
                        <select name="periodo" class="form-select form-select-sm" onchange="this.form.submit()">
                            <option value="hoje" {% if periodo == 'hoje' %}selected{% endif %}>Hoje</option>
                            <option value="ontem" {% if periodo == 'ontem' %}selected{% endif %}>Ontem</option>
                            <option value="semana" {% if periodo == 'semana' %}selected{% endif %}>Esta Semana</option>
                            <option value="mes" {% if periodo == 'mes' %}selected{% endif %}>Este Mês</option>
                            <option value="personalizado" {% if periodo == 'personalizado' %}selected{% endif %}>Personalizado</option>
                        </select>
                    </div>
                    
                    {% if periodo == 'personalizado' %}
                    <div class="col-md-3">
                        <label class="form-label mb-0">De</label>
                        <input type="date" name="data_inicio" class="form-control form-control-sm" 
                               value="{{ data_inicio|date:'Y-m-d' }}" onchange="this.form.submit()">
                    </div>
                    <div class="col-md-3">
                        <label class="form-label mb-0">Até</label>
                        <input type="date" name="data_fim" class="form-control form-control-sm" 
                               value="{{ data_fim|date:'Y-m-d' }}" onchange="this.form.submit()">
                    </div>
                    {% endif %}
                    
                    <div class="col-md-3">
                        <label class="form-label mb-0">Estabelecimento</label>
                        <select name="estabelecimento" class="form-select form-select-sm" onchange="this.form.submit()">
                            <option value="">Todos</option>
                            {% for estab in estabelecimentos %}
                            <option value="{{ estab.id }}" 
                                    {% if estabelecimento_selecionado and estabelecimento_selecionado.id == estab.id %}selected{% endif %}>
                                {{ estab.nome }}
                            </option>
                            {% endfor %}
                        </select>
                    </div>
                </form>
            </div>
        </div>

        <!-- Estatísticas Principais (Cards Interativos) -->
        <div class="row mb-4">
            <div class="col-xl-3 col-md-6 mb-3">
                <div class="card text-white bg-primary-gradient stat-card" onclick="showSection('profissionais')">
                    <div class="card-body d-flex flex-column">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div>
                                <h6 class="card-title opacity-75 mb-1">Profissionais Ativos</h6>
                                <h2 class="card-text fw-bold">{{ total_profissionais }}</h2>
                                {% if periodo == 'hoje' and qtd_sem_registro > 0 %}
                                <small class="opacity-75">{{ qtd_sem_registro }} sem registro</small>
                                {% else %}
                                <small class="opacity-75">Total no sistema</small>
                                {% endif %}
                            </div>
                            <i class="fas fa-users stat-icon"></i>
                        </div>
                        <div class="mt-auto">
                            <small><i class="fas fa-mouse-pointer me-1"></i> Clique para ver detalhes</small>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-md-6 mb-3">
                <div class="card text-white bg-success-gradient stat-card" onclick="showSection('registros')">
                    <div class="card-body d-flex flex-column">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div>
                                <h6 class="card-title opacity-75 mb-1">Registros Hoje</h6>
                                <h2 class="card-text fw-bold">{{ registros_hoje }}</h2>
                                <small class="opacity-75">{{ entradas_hoje }} entradas / {{ saidas_hoje }} saídas</small>
                            </div>
                            <i class="fas fa-clock stat-icon"></i>
                        </div>
                        <div class="mt-auto">
                            <small><i class="fas fa-mouse-pointer me-1"></i> Clique para ver registros</small>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-md-6 mb-3">
                <div class="card text-white bg-warning-gradient stat-card" onclick="showSection('atrasos')">
                    <div class="card-body d-flex flex-column">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div>
                                <h6 class="card-title opacity-75 mb-1">Situações Pendentes</h6>
                                <h2 class="card-text fw-bold">{{ qtd_incompletos|add:qtd_sem_registro }}</h2>
                                <small class="opacity-75">
                                    {{ qtd_incompletos }} incompletos + {{ qtd_sem_registro }} sem registro
                                </small>
                            </div>
                            <i class="fas fa-exclamation-triangle stat-icon"></i>
                        </div>
                        <div class="mt-auto">
                            <small><i class="fas fa-mouse-pointer me-1"></i> Clique para resolver</small>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-md-6 mb-3">
                <div class="card text-white bg-info-gradient stat-card" onclick="showSection('tolerancia')">
                    <div class="card-body d-flex flex-column">
                        <div class="d-flex justify-content-between align-items-start mb-3">
                            <div>
                                <h6 class="card-title opacity-75 mb-1">Controle de Tolerância</h6>
                                <h2 class="card-text fw-bold">{{ percentual_dentro_tolerancia|floatformat:0 }}%</h2>
                                <small class="opacity-75">
                                    {{ registros_dentro_tolerancia }} de {{ total_registros_periodo }} dentro
                                </small>
                            </div>
                            <i class="fas fa-percent stat-icon"></i>
                        </div>
                        <div class="mt-auto">
                            <small><i class="fas fa-mouse-pointer me-1"></i> Clique para análise</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabs para Conteúdo Detalhado -->
        <div class="card mb-4">
            <div class="card-header bg-white border-bottom-0">
                <ul class="nav nav-tabs nav-tabs-custom" id="dashboardTabs" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="situacoes-tab" data-bs-toggle="tab" 
                                data-bs-target="#situacoes" type="button" role="tab">
                            <i class="fas fa-exclamation-triangle me-2"></i>Situações Críticas
                            {% if qtd_incompletos > 0 or qtd_sem_registro > 0 %}
                            <span class="badge bg-danger ms-2">{{ qtd_incompletos|add:qtd_sem_registro }}</span>
                            {% endif %}
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="atrasos-tab" data-bs-toggle="tab" 
                                data-bs-target="#atrasos" type="button" role="tab">
                            <i class="fas fa-clock me-2"></i>Atrasos e Pontualidade
                            {% if estatisticas_atrasos.total_atrasos > 0 %}
                            <span class="badge bg-warning ms-2">{{ estatisticas_atrasos.total_atrasos }}</span>
                            {% endif %}
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="registros-tab" data-bs-toggle="tab" 
                                data-bs-target="#registros" type="button" role="tab">
                            <i class="fas fa-history me-2"></i>Últimos Registros
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="analise-tab" data-bs-toggle="tab" 
                                data-bs-target="#analise" type="button" role="tab">
                            <i class="fas fa-chart-pie me-2"></i>Análise e Gráficos
                        </button>
                    </li>
                </ul>
            </div>
            
            <div class="card-body">
                <div class="tab-content" id="dashboardTabsContent">
                    <!-- Tab 1: Situações Críticas -->
                    <div class="tab-pane fade show active" id="situacoes" role="tabpanel">
                        <div class="row">
                            <!-- Profissionais sem registro -->
                            <div class="col-lg-6 mb-4">
                                <div class="card h-100">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h6 class="mb-0">
                                            <span class="status-indicator status-danger"></span>
                                            Sem Registro Hoje
                                        </h6>
                                        <span class="badge bg-danger">{{ qtd_sem_registro }}</span>
                                    </div>
                                    <div class="card-body p-0">
                                        {% if profissionais_sem_registro_hoje %}
                                            <div class="list-group list-group-flush compact-list">
                                                {% for prof in profissionais_sem_registro_hoje %}
                                                <a href="{% url 'usuarios:detalhar_profissional' prof.id %}" 
                                                   class="list-group-item list-group-item-action">
                                                    <div class="d-flex align-items-center">
                                                        <div class="flex-grow-1">
                                                            <strong>{{ prof.nome }}</strong>
                                                            <br>
                                                            <small class="text-muted">{{ prof.cpf }}</small>
                                                        </div>
                                                        <i class="fas fa-chevron-right text-muted"></i>
                                                    </div>
                                                </a>
                                                {% endfor %}
                                            </div>
                                        {% else %}
                                            <div class="text-center py-4">
                                                <i class="fas fa-check-circle fa-2x text-success mb-3"></i>
                                                <p class="text-muted mb-0">Todos já registraram hoje</p>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                            <!-- Registros incompletos -->
                            <div class="col-lg-6 mb-4">
                                <div class="card h-100">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h6 class="mb-0">
                                            <span class="status-indicator status-warning"></span>
                                            Registros Incompletos
                                        </h6>
                                        <span class="badge bg-warning">{{ qtd_incompletos }}</span>
                                    </div>
                                    <div class="card-body p-0">
                                        {% if registros_incompletos_hoje %}
                                            <div class="list-group list-group-flush compact-list">
                                                {% for registro in registros_incompletos_hoje %}
                                                <a href="{% url 'core:relatorio_profissional' registro.profissional.id %}" 
                                                   class="list-group-item list-group-item-action">
                                                    <div class="d-flex align-items-center">
                                                        <div class="flex-grow-1">
                                                            <strong>{{ registro.profissional.nome }}</strong>
                                                            <br>
                                                            <small class="text-muted">
                                                                Entrada: {{ registro.horario_entrada|time:"H:i" }}
                                                                {% if registro.atraso_minutos > 0 %}
                                                                <span class="text-danger ms-2">(+{{ registro.atraso_minutos }}min)</span>
                                                                {% endif %}
                                                            </small>
                                                        </div>
                                                        <i class="fas fa-chevron-right text-muted"></i>
                                                    </div>
                                                </a>
                                                {% endfor %}
                                            </div>
                                        {% else %}
                                            <div class="text-center py-4">
                                                <i class="fas fa-check-circle fa-2x text-success mb-3"></i>
                                                <p class="text-muted mb-0">Nenhum registro incompleto</p>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tab 2: Atrasos e Pontualidade -->
                    <div class="tab-pane fade" id="atrasos" role="tabpanel">
                        <div class="row">
                            <!-- Gráfico de Pontualidade -->
                            <div class="col-lg-5 mb-4">
                                <div class="card h-100">
                                    <div class="card-body">
                                        <h6 class="mb-3">Distribuição de Pontualidade</h6>
                                        <div class="chart-container">
                                            <canvas id="pontualidadeChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Maiores Atrasos -->
                            <div class="col-lg-7 mb-4">
                                <div class="card h-100">
                                    <div class="card-header">
                                        <h6 class="mb-0">
                                            <i class="fas fa-list-ol me-2"></i> Maiores Atrasos de Hoje
                                        </h6>
                                    </div>
                                    <div class="card-body p-0">
                                        {% if maiores_atrasos_hoje %}
                                            <div class="table-responsive">
                                                <table class="table table-hover mb-0">
                                                    <thead class="table-light">
                                                        <tr>
                                                            <th>Profissional</th>
                                                            <th class="text-center">Entrada</th>
                                                            <th class="text-center">Atraso</th>
                                                            <th class="text-center">Status</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        {% for atraso in maiores_atrasos_hoje %}
                                                        <tr onclick="window.location='{% url 'core:relatorio_profissional' atraso.profissional.id %}'" 
                                                            style="cursor: pointer;">
                                                            <td>
                                                                <strong>{{ atraso.profissional.nome }}</strong>
                                                                <br>
                                                                <small class="text-muted">{{ atraso.estabelecimento.nome }}</small>
                                                            </td>
                                                            <td class="text-center">{{ atraso.horario|time:"H:i" }}</td>
                                                            <td class="text-center">
                                                                <span class="badge {% if atraso.atraso_minutos > 30 %}bg-danger{% else %}bg-warning text-dark{% endif %}">
                                                                    +{{ atraso.atraso_minutos }} min
                                                                </span>
                                                            </td>
                                                            <td class="text-center">
                                                                {% if atraso.atraso_minutos > 30 %}
                                                                <span class="badge bg-danger">Crítico</span>
                                                                {% elif atraso.atraso_minutos > 15 %}
                                                                <span class="badge bg-warning">Alto</span>
                                                                {% else %}
                                                                <span class="badge bg-info">Moderado</span>
                                                                {% endif %}
                                                            </td>
                                                        </tr>
                                                        {% endfor %}
                                                    </tbody>
                                                </table>
                                            </div>
                                        {% else %}
                                            <div class="text-center py-4">
                                                <i class="fas fa-check-circle fa-2x text-success mb-3"></i>
                                                <p class="text-muted mb-0">Nenhum atraso registrado hoje</p>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tab 3: Últimos Registros -->
                    <div class="tab-pane fade" id="registros" role="tabpanel">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h6 class="mb-0">
                                    <i class="fas fa-history me-2"></i> Últimos Registros de Ponto
                                </h6>
                                <a href="{% url 'core:relatorios_gerais' %}" class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-external-link-alt me-1"></i> Ver Todos
                                </a>
                            </div>
                            <div class="card-body p-0">
                                <div class="table-responsive">
                                    <table class="table table-hover mb-0">
                                        <thead class="table-light">
                                            <tr>
                                                <th>Data/Hora</th>
                                                <th>Profissional</th>
                                                <th>Estabelecimento</th>
                                                <th>Tipo</th>
                                                <th>Status</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for registro in ultimos_registros %}
                                            <tr onclick="window.location='{% url 'core:relatorio_profissional' registro.profissional.id %}'" 
                                                style="cursor: pointer;">
                                                <td>
                                                    <small class="text-muted">{{ registro.data|date:"d/m" }}</small><br>
                                                    <strong>{{ registro.horario|time:"H:i" }}</strong>
                                                </td>
                                                <td>
                                                    <strong>{{ registro.profissional.nome }}</strong>
                                                </td>
                                                <td>{{ registro.estabelecimento.nome }}</td>
                                                <td>
                                                    <span class="badge {% if registro.tipo == 'ENTRADA' %}bg-success{% else %}bg-danger{% endif %}">
                                                        {{ registro.get_tipo_display }}
                                                    </span>
                                                </td>
                                                <td>
                                                    {% if registro.tipo == 'ENTRADA' and registro.atraso_minutos > 0 %}
                                                        <span class="badge bg-warning text-dark">
                                                            <i class="fas fa-clock me-1"></i>+{{ registro.atraso_minutos }}min
                                                        </span>
                                                    {% elif registro.tipo == 'SAIDA' and registro.saida_antecipada_minutos > 0 %}
                                                        <span class="badge bg-warning text-dark">
                                                            <i class="fas fa-clock me-1"></i>-{{ registro.saida_antecipada_minutos }}min
                                                        </span>
                                                    {% else %}
                                                        <span class="badge bg-success">
                                                            <i class="fas fa-check me-1"></i>OK
                                                        </span>
                                                    {% endif %}
                                                </td>
                                            </tr>
                                            {% empty %}
                                            <tr>
                                                <td colspan="5" class="text-center py-4 text-muted">
                                                    <i class="fas fa-inbox fa-2x mb-3 opacity-50"></i><br>
                                                    Nenhum registro encontrado
                                                </td>
                                            </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Tab 4: Análise e Gráficos -->
                    <div class="tab-pane fade" id="analise" role="tabpanel">
                        <div class="row">
                            <!-- Progresso do Dia -->
                            <div class="col-lg-6 mb-4">
                                <div class="card h-100">
                                    <div class="card-body">
                                        <h6 class="mb-3">Controle de Tolerância</h6>
                                        <div class="mb-4">
                                            <div class="d-flex justify-content-between mb-2">
                                                <span>Registros dentro da tolerância</span>
                                                <strong>{{ percentual_dentro_tolerancia|floatformat:0 }}%</strong>
                                            </div>
                                            <div class="progress" style="height: 12px;">
                                                <div class="progress-bar bg-success" 
                                                     style="width: {{ percentual_dentro_tolerancia }}%"></div>
                                            </div>
                                            <small class="text-muted">
                                                {{ registros_dentro_tolerancia }} de {{ total_registros_periodo }} registros
                                            </small>
                                        </div>
                                        
                                        <div class="row text-center mt-4">
                                            <div class="col-6">
                                                <div class="display-4 text-primary">{{ estatisticas_atrasos.total_atrasos|default:0 }}</div>
                                                <small class="text-muted">Total de Atrasos</small>
                                            </div>
                                            <div class="col-6">
                                                <div class="display-4 text-warning">{{ estatisticas_atrasos.soma_atrasos|default:0 }}</div>
                                                <small class="text-muted">Minutos Totais</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Estatísticas Resumidas -->
                            <div class="col-lg-6 mb-4">
                                <div class="card h-100">
                                    <div class="card-body">
                                        <h6 class="mb-3">Estatísticas do Período</h6>
                                        <div class="row">
                                            <div class="col-6 mb-3">
                                                <div class="text-center p-3 border rounded">
                                                    <div class="display-5 text-success">{{ entradas_hoje }}</div>
                                                    <small class="text-muted">Entradas Hoje</small>
                                                </div>
                                            </div>
                                            <div class="col-6 mb-3">
                                                <div class="text-center p-3 border rounded">
                                                    <div class="display-5 text-danger">{{ saidas_hoje }}</div>
                                                    <small class="text-muted">Saídas Hoje</small>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <div class="text-center p-3 border rounded">
                                                    <div class="display-5 text-info">{{ estatisticas_atrasos.media_atrasos|floatformat:0|default:0 }}</div>
                                                    <small class="text-muted">Média Atraso (min)</small>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <div class="text-center p-3 border rounded">
                                                    <div class="display-5 text-warning">{{ estatisticas_atrasos.max_atraso|default:0 }}</div>
                                                    <small class="text-muted">Maior Atraso (min)</small>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ações Rápidas -->
        <div class="card mb-4">
            <div class="card-header bg-white">
                <h6 class="mb-0">
                    <i class="fas fa-bolt me-2"></i> Ações Rápidas
                </h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-3 col-6 mb-3">
                        <a href="{% url 'usuarios:solicitar_cadastro' %}" 
                           class="btn btn-outline-success w-100 d-flex flex-column align-items-center py-3">
                            <i class="fas fa-user-plus fa-2x mb-2"></i>
                            <span>Novo Funcionário</span>
                        </a>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                        <a href="{% url 'usuarios:listar_profissionais' %}" 
                           class="btn btn-outline-primary w-100 d-flex flex-column align-items-center py-3">
                            <i class="fas fa-users fa-2x mb-2"></i>
                            <span>Gerenciar Profissionais</span>
                        </a>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                        <a href="{% url 'core:relatorios_gerais' %}" 
                           class="btn btn-outline-info w-100 d-flex flex-column align-items-center py-3">
                            <i class="fas fa-chart-bar fa-2x mb-2"></i>
                            <span>Relatórios Gerais</span>
                        </a>
                    </div>
                    <div class="col-md-3 col-6 mb-3">
                        <button onclick="refreshDashboard()" 
                           class="btn btn-outline-warning w-100 d-flex flex-column align-items-center py-3">
                            <i class="fas fa-sync-alt fa-2x mb-2"></i>
                            <span>Atualizar Dashboard</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Gráfico de Pontualidade
        const ctx = document.getElementById('pontualidadeChart').getContext('2d');
        const pontualidadeChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Pontual', 'Com Atraso'],
                datasets: [{
                    data: [
                        {{ estatisticas_atrasos.percentual_pontual|default:100 }},
                        {{ estatisticas_atrasos.percentual_atrasos|default:0 }}
                    ],
                    backgroundColor: ['#28a745', '#dc3545'],
                    borderWidth: 1,
                    borderColor: '#fff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '70%',
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 20,
                            usePointStyle: true,
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return `${context.label}: ${context.raw}%`;
                            }
                        }
                    }
                }
            }
        });

        // Função para mostrar seção específica
        function showSection(section) {
            const tabMap = {
                'profissionais': 'situacoes-tab',
                'registros': 'registros-tab',
                'atrasos': 'atrasos-tab',
                'tolerancia': 'analise-tab'
            };
            
            const tabId = tabMap[section];
            if (tabId) {
                const tab = new bootstrap.Tab(document.getElementById(tabId));
                tab.show();
            }
        }

        // Atualizar dashboard
        function refreshDashboard() {
            const btn = document.querySelector('[onclick="refreshDashboard()"]');
            const originalHtml = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin fa-2x mb-2"></i><span>Atualizando...</span>';
            btn.disabled = true;
            
            setTimeout(() => {
                window.location.reload();
            }, 1000);
        }

        // Atualização automática a cada 2 minutos
        setTimeout(function() {
            refreshDashboard();
        }, 120000);

        // Hover effects para cards
        document.querySelectorAll('.stat-card').forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-5px)';
            });
            
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
            });
        });

        // Notificações para situações críticas
        document.addEventListener('DOMContentLoaded', function() {
            const totalPendentes = {{ qtd_incompletos|add:qtd_sem_registro }};
            const totalAtrasos = {{ estatisticas_atrasos.total_atrasos|default:0 }};
            
            if (totalPendentes > 0) {
                showNotification(
                    'Situações Pendentes', 
                    `Existem ${totalPendentes} situação(ões) pendente(s) que precisam de atenção.`,
                    'warning'
                );
            }
            
            if (totalAtrasos > 5) {
                showNotification(
                    'Atrasos Detectados',
                    `Foram registrados ${totalAtrasos} atrasos hoje. Verifique a aba de Atrasos.`,
                    'info'
                );
            }
        });

        function showNotification(title, message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 1050; min-width: 300px; max-width: 400px;';
            alertDiv.innerHTML = `
                <div class="d-flex">
                    <div class="flex-grow-1">
                        <strong>${title}</strong>
                        <p class="mb-0 small">${message}</p>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    const bsAlert = new bootstrap.Alert(alertDiv);
                    bsAlert.close();
                }
            }, 5000);
        }
    </script>
</body>
</html>