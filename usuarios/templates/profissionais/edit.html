{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editar Profissional - TimeFlow</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3f37c9;
            --success-color: #4cc9f0;
            --info-color: #4895ef;
            --warning-color: #f72585;
            --light-bg: #f5f7fb;
            --card-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --hover-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        }
        
        body {
            background-color: var(--light-bg);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #2d3748;
            padding-top: 0;
        }
        
        .container {
            max-width: 95%;
            margin-top: 2rem;
        }
        
        .card {
            border: none;
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
            overflow: hidden;
        }
        
        .card:hover {
            box-shadow: var(--hover-shadow);
            transform: translateY(-2px);
        }
        
        .card-header {
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            padding: 1.25rem 1.5rem;
            background: white;
        }
        
        .navbar {
            border-radius: 0 0 12px 12px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        .btn {
            border-radius: 8px;
            font-weight: 500;
            padding: 0.5rem 1.25rem;
            transition: all 0.2s ease;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-primary:hover {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background-color: #e74c3c;
            border-color: #e74c3c;
        }
        
        .form-control, .form-select {
            border-radius: 8px;
            padding: 0.75rem 1rem;
            border: 1px solid #e2e8f0;
            transition: all 0.2s ease;
            font-size: 0.95rem;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(67, 97, 238, 0.25);
        }
        
        .form-label {
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .required-field::after {
            content: " *";
            color: #e74c3c;
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-weight: 600;
        }
        
        .page-title {
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 0.5rem;
        }
        
        .text-muted {
            color: #718096 !important;
        }
        
        /* Navbar gradient */
        .navbar.bg-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)) !important;
        }
        
        /* Card header gradient */
        .card-header.bg-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)) !important;
        }
        
        /* Error styles */
        .error-message {
            font-size: 0.8rem;
            margin-top: 0.25rem;
        }
        
        .is-invalid {
            border-color: #e74c3c !important;
        }
        
        .is-invalid:focus {
            box-shadow: 0 0 0 0.2rem rgba(231, 76, 60, 0.25) !important;
        }
        
        /* Form sections */
        .form-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: white;
            border-radius: 12px;
            box-shadow: var(--card-shadow);
        }
        
        .form-section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #e2e8f0;
        }
        
        /* Time input styles */
        .time-input-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .time-input {
            flex: 1;
        }
        
        .time-separator {
            color: #718096;
            font-weight: 600;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .btn {
                width: 100%;
                margin-bottom: 0.5rem;
            }
            
            .container {
                margin-top: 1rem;
            }
            
            .form-section {
                padding: 1rem;
            }
            
            .time-input-group {
                flex-direction: column;
                gap: 0.25rem;
            }
            
            .time-separator {
                display: none;
            }
        }
        
        /* Help text */
        .help-text {
            font-size: 0.8rem;
            color: #718096;
            margin-top: 0.25rem;
        }
        
        /* Optional field indicator */
        .optional-field::after {
            content: " (opcional)";
            color: #718096;
            font-weight: normal;
        }

        /* Estilos específicos para campos de tempo */
        input[type="time"]::-webkit-calendar-picker-indicator {
            background: none;
            display: none;
        }

        .time-field-wrapper {
            position: relative;
        }

        .time-field-wrapper::after {
            content: "⏰";
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #718096;
            pointer-events: none;
        }

        /* Estilo para campos de carga horária */
        .carga-horaria-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .carga-horaria-info {
            background: #e8f5e8;
            border: 1px solid #28a745;
            border-radius: 8px;
            padding: 0.75rem;
            margin-top: 0.5rem;
            font-size: 0.9rem;
            display: none;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center" href="{% url 'core:dashboard' %}">
                <i class="fas fa-user-edit me-2"></i> TimeFlow - Editar
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link text-white d-flex align-items-center" href="{% url 'core:dashboard' %}">
                            <i class="fas fa-tachometer-alt me-1"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white d-flex align-items-center" href="{% url 'usuarios:profissionais' %}">
                            <i class="fas fa-users me-1"></i> Profissionais
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white d-flex align-items-center active" href="{% url 'usuarios:cadastrar_profissional' %}">
                            <i class="fas fa-user-plus me-1"></i> Cadastrar
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-white d-flex align-items-center" href="/admin/">
                            <i class="fas fa-cog me-1"></i> Admin
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container">
        <!-- Cabeçalho -->
        <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4">
            <div>
                <h1 class="page-title">
                    <i class="fas fa-user-edit me-2" style="color: var(--primary-color);"></i>
                    Editar Profissional
                </h1>
                <p class="text-muted mb-0">Atualize os dados do profissional abaixo</p>
            </div>
        </div>

        <!-- Formulário -->
        <div class="card">
            <div class="card-header d-flex align-items-center" style="background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));">
                <h5 class="mb-0 text-white">
                    <i class="fas fa-id-card me-2"></i> Dados do Profissional
                </h5>
            </div>
            <div class="card-body">
                <p class="text-muted mb-4">
                    <i class="fas fa-info-circle me-1"></i>
                    Campos marcados com <span class="text-danger">*</span> são obrigatórios
                </p>

                <form method="POST" id="profissionalForm">
                    {% csrf_token %}
                    
                    <!-- Mensagens de erro gerais -->
                    {% if user_form.non_field_errors %}
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        {{ user_form.non_field_errors }}
                    </div>
                    {% endif %}

                    <!-- Seção: Dados de Acesso -->
                    <div class="form-section">
                        <h6 class="form-section-title">
                            <i class="fas fa-key me-2"></i> Dados de Acesso
                        </h6>
                        <div class="row">
                            {% for field in user_form %}
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="{{ field.id_for_label }}" class="form-label {% if field.field.required %}required-field{% endif %}">
                                        {{ field.label }}
                                    </label>
                                    {{ field }}
                                    {% if field.errors %}
                                    <div class="error-message text-danger">
                                        <i class="fas fa-exclamation-circle me-1"></i>
                                        {{ field.errors.0 }}
                                    </div>
                                    {% endif %}
                                    {% if field.help_text %}
                                    <div class="help-text">{{ field.help_text }}</div>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Seção: Dados Pessoais -->
                    <div class="form-section">
                        <h6 class="form-section-title">
                            <i class="fas fa-user me-2"></i> Dados Pessoais
                        </h6>
                        <div class="row">
                            <div class="col-md-5">
                                <div class="form-group">
                                    <label for="{{ profissional_form.nome.id_for_label }}" class="form-label required-field">
                                        Nome Completo
                                    </label>
                                    {{ profissional_form.nome }}
                                    {% if profissional_form.nome.errors %}
                                    <div class="error-message text-danger">
                                        <i class="fas fa-exclamation-circle me-1"></i>
                                        {{ profissional_form.nome.errors.0 }}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="{{ profissional_form.sobrenome.id_for_label }}" class="form-label required-field">
                                        Nome Social
                                    </label>
                                    {{ profissional_form.sobrenome }}
                                    {% if profissional_form.sobrenome.errors %}
                                    <div class="error-message text-danger">
                                        <i class="fas fa-exclamation-circle me-1"></i>
                                        {{ profissional_form.sobrenome.errors.0 }}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="form-group">
                                    <label for="{{ profissional_form.email.id_for_label }}" class="form-label required-field">
                                        Email
                                    </label>
                                    {{ profissional_form.email }}
                                    {% if profissional_form.email.errors %}
                                    <div class="error-message text-danger">
                                        <i class="fas fa-exclamation-circle me-1"></i>
                                        {{ profissional_form.email.errors.0 }}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="id_telefone" class="form-label required-field">
                                        Telefone
                                    </label>
                                    {{ profissional_form.telefone }}
                                    {% if profissional_form.telefone.errors %}
                                    <div class="error-message text-danger" id="telefone_error">
                                        <i class="fas fa-exclamation-circle me-1"></i>
                                        {{ profissional_form.telefone.errors.0 }}
                                    </div>
                                    {% endif %}
                                    <div class="help-text">Formato: (11) 99999-9999</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="{{ profissional_form.cpf.id_for_label }}" class="form-label required-field">
                                        CPF
                                    </label>
                                    {{ profissional_form.cpf }}
                                    {% if profissional_form.cpf.errors %}
                                    <div class="error-message text-danger">
                                        <i class="fas fa-exclamation-circle me-1"></i>
                                        {{ profissional_form.cpf.errors.0 }}
                                    </div>
                                    {% endif %}
                                    <div class="help-text">Sem pontos e barras </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="{{ profissional_form.profissao.id_for_label }}" class="form-label required-field">
                                        Ocupação
                                    </label>
                                    {{ profissional_form.profissao }}
                                    {% if profissional_form.profissao.errors %}
                                    <div class="error-message text-danger">
                                        <i class="fas fa-exclamation-circle me-1"></i>
                                        {{ profissional_form.profissao.errors.0 }}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="{{ profissional_form.municipio.id_for_label }}" class="form-label required-field">
                                        Município
                                    </label>
                                    {{ profissional_form.municipio }}
                                    {% if profissional_form.municipio.errors %}
                                    <div class="error-message text-danger">
                                        <i class="fas fa-exclamation-circle me-1"></i>
                                        {{ profissional_form.municipio.errors.0 }}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Seção: Dados Profissionais -->
                    <div class="form-section">
                        <h6 class="form-section-title">
                            <i class="fas fa-briefcase me-2"></i> Dados Profissionais
                        </h6>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="{{ profissional_form.estabelecimento.id_for_label }}" class="form-label optional-field">
                                        Estabelecimento
                                    </label>
                                    {{ profissional_form.estabelecimento }}
                                    {% if profissional_form.estabelecimento.errors %}
                                    <div class="error-message text-danger">
                                        <i class="fas fa-exclamation-circle me-1"></i>
                                        {{ profissional_form.estabelecimento.errors.0 }}
                                    </div>
                                    {% endif %}
                                    <div class="help-text">Local de trabalho do profissional</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="{{ profissional_form.horario_entrada.id_for_label }}" class="form-label optional-field">
                                        Horário de Entrada
                                    </label>
                                    <div class="time-field-wrapper">
                                        {{ profissional_form.horario_entrada }}
                                    </div>
                                    {% if profissional_form.horario_entrada.errors %}
                                    <div class="error-message text-danger">
                                        <i class="fas fa-exclamation-circle me-1"></i>
                                        {{ profissional_form.horario_entrada.errors.0 }}
                                    </div>
                                    {% endif %}
                                    <div class="help-text">Formato: HH:MM (ex: 08:00)</div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="{{ profissional_form.horario_saida.id_for_label }}" class="form-label optional-field">
                                        Horário de Saída
                                    </label>
                                    <div class="time-field-wrapper">
                                        {{ profissional_form.horario_saida }}
                                    </div>
                                    {% if profissional_form.horario_saida.errors %}
                                    <div class="error-message text-danger">
                                        <i class="fas fa-exclamation-circle me-1"></i>
                                        {{ profissional_form.horario_saida.errors.0 }}
                                    </div>
                                    {% endif %}
                                    <div class="help-text">Formato: HH:MM (ex: 17:00)</div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-3">
                                <div class="form-group">
                                    <label for="{{ profissional_form.tolerancia_minutos.id_for_label }}" class="form-label optional-field">
                                        Tolerância (minutos)
                                    </label>
                                    {{ profissional_form.tolerancia_minutos }}
                                    {% if profissional_form.tolerancia_minutos.errors %}
                                    <div class="error-message text-danger">
                                        <i class="fas fa-exclamation-circle me-1"></i>
                                        {{ profissional_form.tolerancia_minutos.errors.0 }}
                                    </div>
                                    {% endif %}
                                    <div class="help-text">Minutos de tolerância para atrasos</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- NOVA SEÇÃO: Carga Horária -->
                    <div class="form-section">
                        <h6 class="form-section-title">
                            <i class="fas fa-clock me-2"></i> Carga Horária
                        </h6>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="{{ profissional_form.carga_horaria_diaria.id_for_label }}" class="form-label required-field">
                                        Carga Horária Diária
                                    </label>
                                    <div class="input-group">
                                        <span class="input-group-text">
                                            <i class="fas fa-clock"></i>
                                        </span>
                                        {{ profissional_form.carga_horaria_diaria }}
                                    </div>
                                    <small class="form-text text-muted">Horas trabalhadas por dia</small>
                                    {% if profissional_form.carga_horaria_diaria.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ profissional_form.carga_horaria_diaria.errors }}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="{{ profissional_form.carga_horaria_semanal.id_for_label }}" class="form-label required-field">
                                        Carga Horária Semanal
                                    </label>
                                    <div class="input-group">
                                        <span class="input-group-text">
                                            <i class="fas fa-calendar-week"></i>
                                        </span>
                                        {{ profissional_form.carga_horaria_semanal }}
                                    </div>
                                    <small class="form-text text-muted">Horas trabalhadas por semana</small>
                                    {% if profissional_form.carga_horaria_semanal.errors %}
                                    <div class="invalid-feedback d-block">
                                        {{ profissional_form.carga_horaria_semanal.errors }}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Informação sobre cálculo automático -->
                        <div id="carga-horaria-info" class="carga-horaria-info" style="display: none;">
                            <i class="fas fa-calculator me-2"></i>
                            <strong>Cálculo automático:</strong> <span id="carga-calculada"></span>
                        </div>
                    </div>

                    <!-- Seção: Status e Configurações -->
                    <div class="form-section">
                        <h6 class="form-section-title">
                            <i class="fas fa-cog me-2"></i> Status e Configurações
                        </h6>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label for="{{ profissional_form.ativo.id_for_label }}" class="form-label">
                                        Status do Profissional
                                    </label>
                                    <div class="form-check form-switch">
                                        {{ profissional_form.ativo }}
                                        <label class="form-check-label" for="{{ profissional_form.ativo.id_for_label }}">
                                            Profissional Ativo
                                        </label>
                                    </div>
                                    {% if profissional_form.ativo.errors %}
                                    <div class="error-message text-danger">
                                        <i class="fas fa-exclamation-circle me-1"></i>
                                        {{ profissional_form.ativo.errors.0 }}
                                    </div>
                                    {% endif %}
                                    <div class="help-text">Desative para tornar o profissional inativo no sistema</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Botões de Ação -->
                    <div class="d-flex flex-column flex-md-row justify-content-between align-items-center gap-3 mt-4 pt-3 border-top">
                        <div class="order-2 order-md-1">
                            <a href="{% url 'usuarios:profissionais' %}" class="btn btn-outline-danger d-flex align-items-center" onclick="return confirm('Tem certeza que deseja cancelar? Todas as informações não salvas serão perdidas.');">
                                <i class="fas fa-times me-2"></i> Cancelar
                            </a>
                        </div>
                        <div class="order-1 order-md-2">
                            <button type="submit" class="btn btn-primary d-flex align-items-center">
                                <i class="fas fa-save me-2"></i> Atualizar Profissional
                            </button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Aplicar classes CSS aos campos do formulário
        document.addEventListener('DOMContentLoaded', function() {
            // Campos de texto, email, password
            const inputFields = document.querySelectorAll('input[type="text"], input[type="email"], input[type="password"]');
            inputFields.forEach(field => {
                field.classList.add('form-control');
            });

            // Campos de tempo
            const timeFields = document.querySelectorAll('input[type="time"]');
            timeFields.forEach(field => {
                field.classList.add('form-control');
                // Formatar valor existente para o formato de tempo
                if (field.value) {
                    field.value = formatTimeValue(field.value);
                }
            });

            // Campos select
            const selectFields = document.querySelectorAll('select');
            selectFields.forEach(select => {
                select.classList.add('form-select');
            });

            // Campo checkbox (ativo)
            const checkboxField = document.querySelector('input[type="checkbox"]');
            if (checkboxField) {
                checkboxField.classList.add('form-check-input');
            }

            // Campos com erro
            const errorFields = document.querySelectorAll('.error-message');
            errorFields.forEach(error => {
                const field = error.previousElementSibling;
                if (field && (field.tagName === 'INPUT' || field.tagName === 'SELECT')) {
                    field.classList.add('is-invalid');
                }
            });

            // Aplicar máscaras imediatamente
            const telefoneField = document.getElementById('id_telefone');
            const cpfField = document.getElementById('id_cpf');

            if (telefoneField && telefoneField.value) {
                telefoneField.value = formatPhoneValue(telefoneField.value);
            }

            if (cpfField && cpfField.value) {
                cpfField.value = formatCPFValue(cpfField.value);
            }

            // Configurar cálculo automático da carga horária
            setupCargaHoraria();
        });

        // Função para formatar valores de tempo
        function formatTimeValue(value) {
            // Se já está no formato HH:MM, mantém
            if (value.match(/^\d{2}:\d{2}$/)) {
                return value;
            }
            
            // Se é um objeto Time ou string com formato diferente
            if (typeof value === 'string') {
                // Tenta extrair horas e minutos
                const timeParts = value.split(':');
                if (timeParts.length >= 2) {
                    const hours = timeParts[0].padStart(2, '0');
                    const minutes = timeParts[1].padStart(2, '0');
                    return `${hours}:${minutes}`;
                }
            }
            
            return value;
        }

        // Máscara para telefone
        function mascaraFone(event) {
            var input = event.target;
            var valor = input.value.replace(/\D/g, "");
            var retorno = "";
            
            if (valor.length > 0) {
                retorno = "(" + valor.substring(0, 2);
            }
            if (valor.length >= 3) {
                retorno += ") " + valor.substring(2, 7);
            }
            if (valor.length >= 7) {
                retorno += "-" + valor.substring(7, 11);
            }
            input.value = retorno;
        }

        // Formatar telefone existente
        function formatPhoneValue(value) {
            if (!value) return '';
            const cleaned = value.replace(/\D/g, "");
            if (cleaned.length === 11) {
                return `(${cleaned.substring(0,2)}) ${cleaned.substring(2,7)}-${cleaned.substring(7,11)}`;
            } else if (cleaned.length === 10) {
                return `(${cleaned.substring(0,2)}) ${cleaned.substring(2,6)}-${cleaned.substring(6,10)}`;
            }
            return value;
        }

        // Máscara para CPF
        function mascaraCPF(event) {
            var input = event.target;
            var valor = input.value.replace(/\D/g, "");
            var retorno = "";
            
            if (valor.length > 0) {
                retorno = valor.substring(0, 3);
            }
            if (valor.length >= 4) {
                retorno += "." + valor.substring(3, 6);
            }
            if (valor.length >= 7) {
                retorno += "." + valor.substring(6, 9);
            }
            if (valor.length >= 10) {
                retorno += "-" + valor.substring(9, 11);
            }
            input.value = retorno;
        }

        // Formatar CPF existente
        function formatCPFValue(value) {
            if (!value) return '';
            const cleaned = value.replace(/\D/g, "");
            if (cleaned.length === 11) {
                return `${cleaned.substring(0,3)}.${cleaned.substring(3,6)}.${cleaned.substring(6,9)}-${cleaned.substring(9,11)}`;
            }
            return value;
        }

        // Validação de campos de tempo
        function validarTempo(input) {
            const valor = input.value;
            if (valor && !valor.match(/^([0-1]?[0-9]|2[0-3]):[0-5][0-9]$/)) {
                input.classList.add('is-invalid');
                return false;
            } else {
                input.classList.remove('is-invalid');
                return true;
            }
        }

        // Cálculo automático da carga horária semanal
        function setupCargaHoraria() {
            const cargaDiaria = document.getElementById('id_carga_horaria_diaria');
            const cargaSemanal = document.getElementById('id_carga_horaria_semanal');
            const infoDiv = document.getElementById('carga-horaria-info');
            const calculoSpan = document.getElementById('carga-calculada');
            
            if (cargaDiaria && cargaSemanal) {
                function calcularCargaSemanal() {
                    const cargaDiariaValue = cargaDiaria.value;
                    
                    if (cargaDiariaValue) {
                        // Converte horas para segundos e calcula semana (5 dias)
                        const [hours, minutes, seconds] = cargaDiariaValue.split(':').map(Number);
                        const totalSecondsDiaria = (hours * 3600) + (minutes * 60) + (seconds || 0);
                        const totalSecondsSemana = totalSecondsDiaria * 5;
                        
                        // Converte de volta para HH:MM:SS
                        const horasSemana = Math.floor(totalSecondsSemana / 3600);
                        const minutosSemana = Math.floor((totalSecondsSemana % 3600) / 60);
                        const segundosSemana = totalSecondsSemana % 60;
                        
                        // Formata o valor para seleção
                        const valorFormatado = 
                            horasSemana.toString().padStart(2, '0') + ':' +
                            minutosSemana.toString().padStart(2, '0') + ':' +
                            segundosSemana.toString().padStart(2, '0');
                        
                        // Mostra informação de cálculo
                        const horasFormatadas = `${horasSemana}h ${minutosSemana.toString().padStart(2, '0')}min`;
                        calculoSpan.textContent = `${horasFormatadas} por semana (5 dias × ${cargaDiariaValue})`;
                        infoDiv.style.display = 'block';
                        
                        // Encontra e seleciona a opção correspondente
                        for (let option of cargaSemanal.options) {
                            if (option.value === valorFormatado) {
                                cargaSemanal.value = valorFormatado;
                                break;
                            }
                        }
                    } else {
                        infoDiv.style.display = 'none';
                    }
                }
                
                cargaDiaria.addEventListener('change', calcularCargaSemanal);
                cargaDiaria.addEventListener('input', calcularCargaSemanal);
                
                // Calcular automaticamente ao carregar a página se já houver valor
                if (cargaDiaria.value) {
                    calcularCargaSemanal();
                }
            }
        }

        // Adicionar event listeners
        const telefoneField = document.getElementById('id_telefone');
        const cpfField = document.getElementById('id_cpf');
        const horarioEntradaField = document.getElementById('id_horario_entrada');
        const horarioSaidaField = document.getElementById('id_horario_saida');

        if (telefoneField) {
            telefoneField.addEventListener('input', mascaraFone);
            telefoneField.setAttribute('placeholder', '(00) 00000-0000');
        }

        if (horarioEntradaField) {
            horarioEntradaField.addEventListener('blur', function() {
                validarTempo(this);
            });
            horarioEntradaField.setAttribute('placeholder', '08:00');
        }

        if (horarioSaidaField) {
            horarioSaidaField.addEventListener('blur', function() {
                validarTempo(this);
            });
            horarioSaidaField.setAttribute('placeholder', '17:00');
        }

        // Validação antes do envio
        document.getElementById('profissionalForm').addEventListener('submit', function(e) {
            const requiredFields = this.querySelectorAll('.required-field');
            let isValid = true;

            requiredFields.forEach(label => {
                const field = label.closest('.form-group').querySelector('input, select');
                if (field && !field.value.trim()) {
                    field.classList.add('is-invalid');
                    isValid = false;
                }
            });

            // Validar campos de tempo
            if (horarioEntradaField && horarioEntradaField.value && !validarTempo(horarioEntradaField)) {
                isValid = false;
            }

            if (horarioSaidaField && horarioSaidaField.value && !validarTempo(horarioSaidaField)) {
                isValid = false;
            }

            if (!isValid) {
                e.preventDefault();
                alert('Por favor, corrija os campos destacados em vermelho antes de enviar o formulário.');
            }
        });
    </script>
</body>
</html>